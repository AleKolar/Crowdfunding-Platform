{% extends "base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - Crowdfunding Platform{% endblock %}

{% block content %}
<div class="jumbotron">
    <h1 class="display-4">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ Crowdfunding Platform! üöÄ</h1>
    <p class="lead">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç—ã, —É—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –≤–µ–±–∏–Ω–∞—Ä–∞—Ö, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∏–¥–µ–∏</p>
    <a class="btn btn-primary btn-lg" href="/dashboard" role="button">–ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∞—à–±–æ—Ä–¥</a>
</div>

<div class="announcements-section mt-5">
    <h2>üéØ –ë–ª–∏–∂–∞–π—à–∏–µ –≤–µ–±–∏–Ω–∞—Ä—ã</h2>
    <div id="webinar-announcements" class="mt-3">
        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è -->
    </div>
</div>

<script>
// –ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
async function loadAnnouncements() {
    try {
        const response = await fetch('/webinars/announcements');
        const data = await response.json();

        const container = document.getElementById('webinar-announcements');
        container.innerHTML = '';

        if (data.announcements.length === 0) {
            container.innerHTML = '<p class="text-muted">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–µ–±–∏–Ω–∞—Ä–æ–≤</p>';
            return;
        }

        data.announcements.forEach(announcement => {
            const announcementEl = document.createElement('div');
            announcementEl.className = 'card mb-3';
            announcementEl.innerHTML = `
                <div class="card-body">
                    <h5 class="card-title">${announcement.title}</h5>
                    <p class="card-text">${announcement.description}</p>
                    <div class="d-flex gap-3 text-muted mb-3">
                        <small>üóìÔ∏è ${new Date(announcement.scheduled_at).toLocaleString('ru-RU')}</small>
                        <small>‚è±Ô∏è ${announcement.duration} –º–∏–Ω.</small>
                        <small>üë• ${announcement.max_participants} –º–µ—Å—Ç</small>
                    </div>
                    <button onclick="registerForWebinar(${announcement.id})" class="btn btn-success btn-sm">
                        üöÄ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                    </button>
                </div>
            `;
            container.appendChild(announcementEl);
        });
    } catch (error) {
        console.error('Error loading announcements:', error);
        document.getElementById('webinar-announcements').innerHTML = 
            '<p class="text-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–µ–±–∏–Ω–∞—Ä–æ–≤</p>';
    }
}

// –§—É–Ω–∫—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
async function registerForWebinar(webinarId) {
    try {
        showNotification('‚è≥ –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º...', 'info');
        
        const response = await fetch(`/webinars/${webinarId}/register`, {
            method: 'POST'
        });

        const result = await response.json();

        if (response.ok) {
            showNotification('üéâ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 'success');
        } else {
            showNotification('‚ùå ' + result.detail, 'error');
        }
    } catch (error) {
        console.error('Registration error:', error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', 'error');
    }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showNotification(message, type = 'info') {
    // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    alert(message);
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', loadAnnouncements);
</script>
{% endblock %}