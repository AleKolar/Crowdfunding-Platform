<!-- templates/home.html -->
<div class="announcements-section">
    <h2>üéØ –ë–ª–∏–∂–∞–π—à–∏–µ –≤–µ–±–∏–Ω–∞—Ä—ã</h2>

    <div id="webinar-announcements">
        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è -->
    </div>
</div>

<script>
// –ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
async function loadAnnouncements() {
    try {
        const response = await fetch('/api/webinars/announcements');
        const data = await response.json();

        const container = document.getElementById('webinar-announcements');
        container.innerHTML = '';

        if (data.announcements.length === 0) {
            container.innerHTML = '<p class="no-announcements">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–µ–±–∏–Ω–∞—Ä–æ–≤</p>';
            return;
        }

        data.announcements.forEach(announcement => {
            const announcementEl = document.createElement('div');
            announcementEl.className = 'announcement-card';
            announcementEl.innerHTML = `
                <h3>${announcement.title}</h3>
                <p class="announcement-description">${announcement.description}</p>
                <div class="announcement-details">
                    <span>üóìÔ∏è ${new Date(announcement.scheduled_at).toLocaleString('ru-RU')}</span>
                    <span>‚è±Ô∏è ${announcement.duration} –º–∏–Ω.</span>
                    <span>üë• ${announcement.max_participants} –º–µ—Å—Ç</span>
                </div>
                <button onclick="registerForWebinar(${announcement.id})" class="register-btn">
                    üöÄ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                </button>
            `;
            container.appendChild(announcementEl);
        });
    } catch (error) {
        console.error('Error loading announcements:', error);
    }
}

// –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - –û–î–ò–ù –ö–õ–ò–ö
async function registerForWebinar(webinarId) {
    try {
        const response = await fetch(`/api/webinars/${webinarId}/register-simple`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${getAuthToken()}` // –≤–∞—à —Ç–æ–∫–µ–Ω
            }
        });

        const result = await response.json();

        if (result.success) {
            if (result.already_registered) {
                showNotification('‚ÑπÔ∏è ' + result.message, 'info');
            } else {
                showNotification('üéâ ' + result.message, 'success');
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É
                event.target.textContent = '‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω';
                event.target.disabled = true;
            }
        } else {
            showNotification('‚ùå ' + result.message, 'error');
        }
    } catch (error) {
        console.error('Registration error:', error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', 'error');
    }
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', loadAnnouncements);
</script>